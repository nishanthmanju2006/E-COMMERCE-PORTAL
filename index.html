/*
E‑Commerce Portal — Single-file React app (App.jsx)

What's included:
- React Router navigation: Home, Products, Contact, About
- User Registration & Login with client-side validation (localStorage)
- Display: Orders list, Wishlist, Comments & Reviews, Customer Care, Reporting
- Mock product data & persistence via localStorage
- Tailwind CSS classes (assumes Tailwind is configured in the project)

How to use:
1. Create a React project (Vite or CRA) and install dependencies:
   - npm create vite@latest my-shop --template react
   - cd my-shop
   - Install react-router-dom and uuid: npm i react-router-dom uuid
   - Setup Tailwind CSS (https://tailwindcss.com/docs/guides/vite)
2. Replace src/App.jsx with the content of this file and ensure src/main.jsx imports './index.css'.
3. Start: npm run dev (Vite) or npm start (CRA)

Notes:
- This is a single-file example aimed for learning and quick prototyping.
- For production, split into separate components, add a real backend, authentication, and stronger validation.
*/

import React, { useEffect, useState } from "react";
import { BrowserRouter as Router, Routes, Route, Link, useNavigate } from "react-router-dom";
import { v4 as uuidv4 } from "uuid";

/* ---------- Mock data helpers ---------- */
const sampleProducts = [
  { id: "p1", name: "Wireless Headphones", price: 1999, rating: 4.5, reviews: [] },
  { id: "p2", name: "Gaming Mouse", price: 799, rating: 4.2, reviews: [] },
  { id: "p3", name: "Mechanical Keyboard", price: 2499, rating: 4.6, reviews: [] }
];

const saveToStorage = (key, value) => localStorage.setItem(key, JSON.stringify(value));
const loadFromStorage = (key, fallback) => {
  try { const v = JSON.parse(localStorage.getItem(key)); return v ?? fallback; } catch { return fallback; }
};

/* ---------- App ---------- */
export default function App() {
  // shared state persisted
  const [products, setProducts] = useState(loadFromStorage("products", sampleProducts));
  const [users, setUsers] = useState(loadFromStorage("users", []));
  const [session, setSession] = useState(loadFromStorage("session", null));
  const [orders, setOrders] = useState(loadFromStorage("orders", []));
  const [wishlist, setWishlist] = useState(loadFromStorage("wishlist", []));

  useEffect(() => saveToStorage("products", products), [products]);
  useEffect(() => saveToStorage("users", users), [users]);
  useEffect(() => saveToStorage("session", session), [session]);
  useEffect(() => saveToStorage("orders", orders), [orders]);
  useEffect(() => saveToStorage("wishlist", wishlist), [wishlist]);

  const addReview = (productId, review) => {
    setProducts(prev => prev.map(p => p.id === productId ? { ...p, reviews: [review, ...p.reviews] } : p));
  };

  const placeOrder = (cartItems) => {
    if (!session) return false;
    const newOrder = { id: uuidv4(), user: session.email, items: cartItems, date: new Date().toISOString() };
    setOrders(prev => [newOrder, ...prev]);
    return true;
  };

  return (
    <Router>
      <div className="min-h-screen bg-gray-50">
        <Header session={session} setSession={setSession} />
        <main className="container mx-auto p-4">
          <Routes>
            <Route path="/" element={<Home products={products} />} />
            <Route path="/products" element={<Products products={products} addReview={addReview} wishlist={wishlist} setWishlist={setWishlist} placeOrder={placeOrder} session={session} />} />
            <Route path="/contact" element={<Contact />} />
            <Route path="/about" element={<About />} />
            <Route path="/register" element={<Register users={users} setUsers={setUsers} setSession={setSession} />} />
            <Route path="/login" element={<Login users={users} setSession={setSession} />} />
            <Route path="/account" element={<Account session={session} orders={orders} wishlist={wishlist} setWishlist={setWishlist} />} />
            <Route path="/support" element={<CustomerCare />} />
            <Route path="/reports" element={<Reports orders={orders} products={products} />} />
            <Route path="*" element={<NotFound />} />
          </Routes>
        </main>
      </div>
    </Router>
  );
}

/* ---------- Header & Nav ---------- */
function Header({ session, setSession }) {
  const navigate = useNavigate();
  const logout = () => { setSession(null); navigate("/"); };

  return (
    <header className="bg-white shadow">
      <div className="container mx-auto flex items-center justify-between p-4">
        <Link to="/" className="text-2xl font-bold text-indigo-600">MyShop</Link>
        <nav className="flex gap-3 items-center">
          <NavLink to="/">Home</NavLink>
          <NavLink to="/products">Products</NavLink>
          <NavLink to="/contact">Contact Us</NavLink>
          <NavLink to="/about">About Us</NavLink>
          <NavLink to="/support">Customer Care</NavLink>
          <NavLink to="/reports">Reports</NavLink>
          {session ? (
            <div className="flex items-center gap-3">
              <Link to="/account" className="px-3 py-1 rounded-md bg-indigo-50">{session.name}</Link>
              <button onClick={logout} className="px-3 py-1 rounded-md border">Logout</button>
            </div>
          ) : (
            <div className="flex gap-2">
              <Link to="/login" className="px-3 py-1 rounded-md border">Login</Link>
              <Link to="/register" className="px-3 py-1 rounded-md bg-indigo-600 text-white">Register</Link>
            </div>
          )}
        </nav>
      </div>
    </header>
  );
}

function NavLink({ to, children }) {
  return <Link to={to} className="hover:underline px-2 py-1">{children}</Link>;
}

/* ---------- Pages ---------- */
function Home({ products }) {
  return (
    <div>
      <h1 className="text-3xl font-semibold mb-4">Welcome to MyShop</h1>
      <p className="mb-6">Buy quality products at great prices.</p>
      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
        {products.map(p => (
          <div key={p.id} className="p-4 bg-white rounded shadow">
            <h3 className="font-semibold">{p.name}</h3>
            <p>₹{p.price}</p>
            <p className="text-sm">Rating: {p.rating} ({p.reviews.length} reviews)</p>
            <Link to="/products" className="text-indigo-600 text-sm">View</Link>
          </div>
        ))}
      </div>
    </div>
  );
}

function Products({ products, addReview, wishlist, setWishlist, placeOrder, session }) {
  const [cart, setCart] = useState([]);
  const [selected, setSelected] = useState(null);

  const toggleWishlist = (pid) => {
    if (wishlist.includes(pid)) setWishlist(wishlist.filter(x => x !== pid));
    else setWishlist([pid, ...wishlist]);
  };

  const addToCart = (p) => setCart(prev => [...prev, p]);
  const checkout = () => {
    if (!session) { alert("Please login to place an order."); return; }
    const success = placeOrder(cart);
    if (success) { alert("Order placed successfully."); setCart([]); }
  };

  return (
    <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
      <div className="md:col-span-2">
        <h2 className="text-2xl font-semibold mb-4">Products</h2>
        <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
          {products.map(p => (
            <div key={p.id} className="p-4 bg-white rounded shadow">
              <h4 className="font-medium">{p.name}</h4>
              <p>₹{p.price}</p>
              <p className="text-sm">{p.rating} ★</p>
              <div className="flex gap-2 mt-2">
                <button onClick={() => addToCart(p)} className="px-3 py-1 rounded-md border">Add to Cart</button>
                <button onClick={() => { setSelected(p); }} className="px-3 py-1 rounded-md">Details</button>
                <button onClick={() => toggleWishlist(p.id)} className="px-3 py-1 rounded-md">{wishlist.includes(p.id) ? 'Wishlisted' : 'Wishlist'}</button>
              </div>
            </div>
          ))}
        </div>
      </div>

      <aside className="p-4 bg-white rounded shadow">
        <h3 className="font-semibold">Cart ({cart.length})</h3>
        <ul className="divide-y mt-2">
          {cart.map((c, i) => <li key={i} className="py-2">{c.name} — ₹{c.price}</li>)}
        </ul>
        <div className="mt-3 flex gap-2">
          <button onClick={checkout} className="px-3 py-1 rounded-md bg-indigo-600 text-white">Checkout</button>
          <button onClick={() => setCart([])} className="px-3 py-1 rounded-md border">Clear</button>
        </div>

        <h4 className="mt-4 font-semibold">Selected product</h4>
        {selected ? (
          <div className="mt-2">
            <p className="font-medium">{selected.name}</p>
            <ProductReviewForm product={selected} onSubmit={(r) => addReview(selected.id, r)} />
            <div className="mt-2">
              <h5 className="font-medium">Reviews</h5>
              {selected.reviews.length === 0 ? <p className="text-sm">No reviews yet.</p> : selected.reviews.map((r, idx) => (
                <div key={idx} className="text-sm border-t py-1">{r.name}: {r.text}</div>
              ))}
            </div>
          </div>
        ) : <p className="text-sm">Choose a product to see details and add a review.</p>}

      </aside>
    </div>
  );
}

function ProductReviewForm({ product, onSubmit }) {
  const [name, setName] = useState("");
  const [text, setText] = useState("");

  const submit = (e) => {
    e.preventDefault();
    if (!name.trim() || !text.trim()) { alert("Please provide name and review."); return; }
    onSubmit({ name, text, date: new Date().toISOString() });
    setName(""); setText("");
  };

  return (
    <form onSubmit={submit} className="mt-2">
      <input value={name} onChange={e => setName(e.target.value)} placeholder="Your name" className="w-full p-2 border rounded mt-1" />
      <textarea value={text} onChange={e => setText(e.target.value)} placeholder="Your review" className="w-full p-2 border rounded mt-1" />
      <button className="mt-2 px-3 py-1 rounded-md bg-indigo-600 text-white">Post Review</button>
    </form>
  );
}

function Contact() {
  return (
    <div className="bg-white p-6 rounded shadow">
      <h2 className="text-2xl font-semibold">Contact Us</h2>
      <p className="mt-2">For support, email support@myshop.example or use the Customer Care page.</p>
    </div>
  );
}

function About() {
  return (
    <div className="bg-white p-6 rounded shadow">
      <h2 className="text-2xl font-semibold">About Us</h2>
      <p className="mt-2">MyShop is a demo e-commerce platform built for learning.</p>
    </div>
  );
}

/* ---------- Auth: Registration & Login with validation ---------- */
function Register({ users, setUsers, setSession }) {
  const navigate = useNavigate();
  const [name, setName] = useState("");
  const [email, setEmail] = useState("");
  const [password, setPassword] = useState("");

  const validateEmail = (e) => /^\S+@\S+\.\S+$/.test(e);
  const validatePassword = (p) => p.length >= 6;

  const submit = (ev) => {
    ev.preventDefault();
    if (!name.trim()) return alert("Name required");
    if (!validateEmail(email)) return alert("Enter a valid email");
    if (!validatePassword(password)) return alert("Password must be at least 6 characters");
    if (users.some(u => u.email === email)) return alert("User with this email already exists");

    const newUser = { id: uuidv4(), name, email, password };
    setUsers([newUser, ...users]);
    setSession({ name, email });
    navigate("/");
  };

  return (
    <div className="max-w-md mx-auto bg-white p-6 rounded shadow">
      <h3 className="text-xl font-semibold mb-3">Register</h3>
      <form onSubmit={submit} className="space-y-2">
        <input value={name} onChange={e=>setName(e.target.value)} placeholder="Full name" className="w-full p-2 border rounded" />
        <input value={email} onChange={e=>setEmail(e.target.value)} placeholder="Email" className="w-full p-2 border rounded" />
        <input value={password} onChange={e=>setPassword(e.target.value)} placeholder="Password" type="password" className="w-full p-2 border rounded" />
        <button className="w-full py-2 rounded bg-indigo-600 text-white">Create account</button>
      </form>
    </div>
  );
}

function Login({ users, setSession }) {
  const navigate = useNavigate();
  const [email, setEmail] = useState("");
  const [password, setPassword] = useState("");

  const submit = (ev) => {
    ev.preventDefault();
    const user = users.find(u => u.email === email && u.password === password);
    if (!user) return alert("Invalid credentials");
    setSession({ name: user.name, email: user.email });
    navigate("/");
  };

  return (
    <div className="max-w-md mx-auto bg-white p-6 rounded shadow">
      <h3 className="text-xl font-semibold mb-3">Login</h3>
      <form onSubmit={submit} className="space-y-2">
        <input value={email} onChange={e=>setEmail(e.target.value)} placeholder="Email" className="w-full p-2 border rounded" />
        <input value={password} onChange={e=>setPassword(e.target.value)} placeholder="Password" type="password" className="w-full p-2 border rounded" />
        <button className="w-full py-2 rounded bg-indigo-600 text-white">Login</button>
      </form>
    </div>
  );
}

/* ---------- Account: Orders, Wishlist, Reports ---------- */
function Account({ session, orders, wishlist, setWishlist }) {
  if (!session) return <div className="bg-white p-6 rounded shadow">Please login to see your account.</div>;

  const myOrders = orders.filter(o => o.user === session.email);

  return (
    <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
      <div className="md:col-span-2 bg-white p-4 rounded shadow">
        <h3 className="font-semibold text-xl">Orders</h3>
        {myOrders.length === 0 ? <p className="mt-2 text-sm">No orders yet.</p> : (
          <ul className="mt-2 divide-y">
            {myOrders.map(o => (
              <li key={o.id} className="py-2">
                <div className="text-sm">Order #{o.id.slice(0,8)} — {new Date(o.date).toLocaleString()}</div>
                <ul className="pl-4">{o.items.map((i,idx) => <li key={idx}>{i.name} — ₹{i.price}</li>)}</ul>
              </li>
            ))}
          </ul>
        )}
      </div>

      <aside className="bg-white p-4 rounded shadow">
        <h4 className="font-semibold">Wishlist</h4>
        {wishlist.length === 0 ? <p className="text-sm mt-2">Your wishlist is empty.</p> : (
          <ul className="mt-2 divide-y">
            {wishlist.map(w => <li key={w} className="py-2">{w} <button onClick={() => setWishlist(wishlist.filter(x=>x!==w))} className="ml-2 text-sm">Remove</button></li>)}
          </ul>
        )}
      </aside>
    </div>
  );
}

/* ---------- Customer Care & Reports ---------- */
function CustomerCare() {
  return (
    <div className="bg-white p-6 rounded shadow">
      <h3 className="text-xl font-semibold">Customer Care</h3>
      <p className="mt-2">For quick help, call +91-12345-67890 or email support@myshop.example.</p>
      <form className="mt-4 space-y-2 max-w-lg">
        <input placeholder="Your email" className="w-full p-2 border rounded" />
        <textarea placeholder="Describe your issue" className="w-full p-2 border rounded" />
        <button className="px-3 py-1 rounded bg-indigo-600 text-white">Submit</button>
      </form>
    </div>
  );
}

function Reports({ orders, products }) {
  // simple reporting examples
  const totalOrders = orders.length;
  const revenue = orders.reduce((s, o) => s + o.items.reduce((si, it) => si + (it.price || 0), 0), 0);

  return (
    <div className="bg-white p-6 rounded shadow">
      <h3 className="text-xl font-semibold">Reports</h3>
      <div className="mt-4 grid grid-cols-1 sm:grid-cols-2 gap-4">
        <div className="p-3 border rounded">Total orders: <strong>{totalOrders}</strong></div>
        <div className="p-3 border rounded">Revenue: <strong>₹{revenue}</strong></div>
        <div className="p-3 border rounded">Products: <strong>{products.length}</strong></div>
      </div>
    </div>
  );
}

/* ---------- Misc ---------- */
function NotFound() { return <div className="bg-white p-6 rounded shadow">Page not found</div>; }

/* End of file */
